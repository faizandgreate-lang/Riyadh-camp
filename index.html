<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Care-Pro Riyadh Accommodation</title>
<style>
body { font-family:"Poppins", Arial, sans-serif; margin:20px; background:linear-gradient(135deg,#cce5ff,#e6f2ff); color:#004085; }
h1,h2,h3,h4{color:#004085;}
h1{ text-align:center; font-size:28px; margin-bottom:15px;}
table{border-collapse:collapse;width:100%;margin:15px 0;box-shadow:0 2px 6px rgba(0,0,0,0.1); background:#fff; border-radius:6px; overflow:hidden;}
th,td{border:1px solid #ddd; padding:8px 10px; text-align:left; font-size:14px;}
th{background:#004085;color:#fff;}
tr:nth-child(even){background:#e6f2ff;}
tr:hover{background:#d1e0ff;}
.form{border:1px solid #ccc; padding:15px; background:#fefefe; border-radius:8px; margin-top:10px;}
.form input, .form select{margin:5px; padding:6px 10px; border-radius:4px;}
.form button{background:#004085; color:#fff; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; margin:5px;}
.form button:hover{background:#0056b3;}
.footer{text-align:center;font-size:13px;color:#555;margin-top:40px;}
@media(max-width:768px){table,th,td{font-size:12px;} .form input,.form select,.form button{width:100%;margin-top:5px;}}
</style>
</head>
<body>
<h1>üè† CARE-PRO RIYADH ACCOMMODATION</h1>

<div>
  <input type="password" id="adminPw" placeholder="Enter Admin Password">
  <button onclick="login()">Login</button>
  <button id="logoutBtn" onclick="logout()" style="display:none;">Logout</button>
</div>

<div id="editor" class="form" style="display:none;">
<h4>üîß ADMIN PANEL</h4>
<label>IQAMA: <input id="f_iq"></label>
<label>Name: <input id="f_name"></label>
<label>Camp: <input id="f_camp"></label>
<label>Company: <input id="f_company"></label>
<label>Gender: <input id="f_gender"></label>
<label>Nationality: <input id="f_nationality"></label>
<label>Sponsor: <input id="f_sponsor"></label>
<label>Room: <input id="f_room"></label><br>
<button onclick="addWorker()">Add Worker</button>
<button onclick="deleteWorker()">Delete Worker</button><br>
<h4>üì§ Import CSV</h4>
<input type="file" id="csvFile" accept=".csv">
<button onclick="importCSV()">Upload CSV</button>
</div>

<h2>üè¢ Workers Table & Totals</h2>
<div id="tableWrap"></div>

<h2>üè¢ Client / Company Summary</h2>
<div id="clientSummary"></div>

<h2>üèòÔ∏è Camp Summary</h2>
<div id="campSummary"></div>

<div class="footer">Made with ‚ù§Ô∏è by <span>Faizan Khan</span></div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz2hWGRihuV9NBcIN7g0VYWG_M-Im-V7Gf_-rKJfZ6Na6Uks70kqAE8Q1EUpG3cdcMnNg/exec';

let isAdmin=false;

function login(){
  if(document.getElementById('adminPw').value==='1234'){
    isAdmin=true; document.getElementById('editor').style.display='block';
    document.getElementById('logoutBtn').style.display='inline-block';
    fetchData();
  } else alert('‚ùå Wrong password!');
}

function logout(){ isAdmin=false; document.getElementById('editor').style.display='none'; document.getElementById('logoutBtn').style.display='none'; }

function fetchData(){
  fetch(WEB_APP_URL, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'getData'})})
  .then(res=>res.json())
  .then(resp=>{
    if(resp.status==='success'){
      renderTable(resp.workers);
      renderClientSummary(resp.workers);
      renderCampSummary(resp.workers);
    } else alert('‚ùå '+resp.message);
  }).catch(err=>alert('Fetch error: '+err));
}

function addWorker(){
  const data={action:'addWorker',
    iq:f_iq.value.trim(), name:f_name.value.trim(), camp:f_camp.value.trim(),
    company:f_company.value.trim(), gender:f_gender.value.trim(),
    nationality:f_nationality.value.trim(), sponsor:f_sponsor.value.trim(),
    room:f_room.value.trim()
  };
  if(!data.iq||!data.name){alert('IQAMA and Name required'); return;}
  fetch(WEB_APP_URL,{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)})
  .then(r=>r.json()).then(resp=>{if(resp.status==='success'){alert('‚úÖ Worker added'); fetchData();}else alert(resp.message);})
  .catch(err=>alert('Fetch error: '+err));
}

function deleteWorker(){
  const iq=prompt('Enter IQAMA to delete:'); if(!iq) return;
  fetch(WEB_APP_URL,{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'deleteWorker',iq})})
  .then(r=>r.json()).then(resp=>{if(resp.status==='success'){alert('‚úÖ Worker deleted'); fetchData();}else alert('‚ùå Worker not found');})
  .catch(err=>alert('Fetch error: '+err));
}

function importCSV(){
  const file=document.getElementById('csvFile').files[0]; if(!file){alert('Select CSV'); return;}
  const reader=new FileReader();
  reader.onload=e=>{
    fetch(WEB_APP_URL,{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'importCSV',csv:e.target.result})})
    .then(r=>r.json()).then(resp=>{if(resp.status==='success'){alert('‚úÖ CSV imported'); fetchData();}else alert(resp.message);})
    .catch(err=>alert('Fetch error: '+err));
  }; reader.readAsText(file);
}

function renderTable(workers){
  let html='<table><tr><th>#</th><th>IQAMA</th><th>Name</th><th>Camp</th><th>Company</th><th>Gender</th><th>Nationality</th><th>Sponsor</th><th>Room</th></tr>';
  workers.forEach((w,i)=>{html+='<tr><td>'+(i+1)+'</td><td>'+w.iq+'</td><td>'+w.name+'</td><td>'+w.camp+'</td><td>'+w.company+'</td><td>'+w.gender+'</td><td>'+w.nationality+'</td><td>'+w.sponsor+'</td><td>'+w.room+'</td></tr>';});
  html+='</table>'; document.getElementById('tableWrap').innerHTML=html;
}

function renderClientSummary(workers){
  let summary={};
  workers.forEach(w=>{
    if(!summary[w.company]) summary[w.company]={'CP 1':0,'CP 2':0,'CP 3':0};
    if(w.camp==='CP 1') summary[w.company]['CP 1']++;
    if(w.camp==='CP 2') summary[w.company]['CP 2']++;
    if(w.camp==='CP 3') summary[w.company]['CP 3']++;
  });
  let html='<table><tr><th>Client / Company</th><th>CP 1</th><th>CP 2</th><th>CP 3</th><th>Total</th></tr>';
  let totals={'CP 1':0,'CP 2':0,'CP 3':0,'Total':0};
  for(let c in summary){
    let t=summary[c]['CP 1']+summary[c]['CP 2']+summary[c]['CP 3'];
    html+='<tr><td>'+c+'</td><td>'+summary[c]['CP 1']+'</td><td>'+summary[c]['CP 2']+'</td><td>'+summary[c]['CP 3']+'</td><td>'+t+'</td></tr>';
    totals['CP 1']+=summary[c]['CP 1']; totals['CP 2']+=summary[c]['CP 2']; totals['CP 3']+=summary[c]['CP 3']; totals['Total']+=t;
  }
  html+='<tr><th>TOTAL</th><th>'+totals['CP 1']+'</th><th>'+totals['CP 2']+'</th><th>'+totals['CP 3']+'</th><th>'+totals['Total']+'</th></tr></table>';
  document.getElementById('clientSummary').innerHTML=html;
}

function renderCampSummary(workers){
  let camps={'CP 1':0,'CP 2':0,'CP 3':0};
  workers.forEach(w=>{if(camps[w.camp]!==undefined) camps[w.camp]++;});
  let html='<table><tr><th>Camp</th><th>Workers Count</th></tr>';
  for(let c in camps) html+='<tr><td>'+c+'</td><td>'+camps[c]+'</td></tr>';
  html+='<tr><th>TOTAL</th><th>'+(camps['CP 1']+camps['CP 2']+camps['CP 3'])+'</th></tr></table>';
  document.getElementById('campSummary').innerHTML=html;
}

// Auto fetch every 30s
setInterval(()=>{ if(isAdmin) fetchData(); },30000);

</script>
</body>
</html>
